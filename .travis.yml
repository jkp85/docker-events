# whitelist
language: go
go:
  - 1.7.1
branches:
  only:
    - master
sudo: required
services:
  - docker
before_install:
  - docker --version  # document the version travis is using
  - pip install awscli # install aws cli w/o sudo
  - export PATH=$PATH:$HOME/.local/bin # put aws in the path
  - eval $(aws ecr get-login --region us-east-1) #needs AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY envvars
  - docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
  - go get -t -v ./...
script:
  - make
after_script:
  - docker build -t $DOCKER_IMAGE_NAME .
  - docker push $DOCKER_IMAGE_NAME:latest
notifications:
  slack: 3blades:NfpxGDhEHu8m6K3bw9c9Mxd0
env:
  - $DOCKER_IMAGE_NAME="3blades/docker-stats"